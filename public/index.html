<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Snohomish County Gym Sites</title>
  <link rel="stylesheet" href="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.css">
  <link rel="stylesheet" href="style.css?v=4">
</head>
<body>
  <div id="mobile-header">
    <span>Snohomish County Gym Sites</span>
    <button id="sidebar-toggle" aria-label="Toggle filters">Filters</button>
  </div>
  <div id="sidebar">
    <h1>Snohomish County Gym Sites</h1>
    <p id="parcel-count">Loading...</p>

    <div id="info-icon-wrap">
      <button id="info-btn" title="Gym-Friendly Criteria">i</button>
      <div id="gym-criteria">
        <strong>About This Tool</strong>
        <p>This map helps identify potential sites for opening a gym or fitness facility in Snohomish County. It displays ~205K parcels from the county assessor's data, filtered down from 318K+ total parcels to only those that could realistically support a gym operation.</p>

        <strong>What Was Removed</strong>
        <ul>
          <li><b>Entire categories:</b> Government, Transportation, and Resource/Agriculture parcels</li>
          <li><b>Residential:</b> Apartments, condos, mobile home parks, hotels, manufactured homes, vacation cabins — only single-family detached homes (use code 111) are kept, since these can convert to gym use with a conditional use permit</li>
          <li><b>Services:</b> Churches, schools, funeral homes, banks, legal offices, military, postal, corrections, insurance, beauty/barber shops, auto repair, medical facilities, mini-warehouses</li>
          <li><b>Trade:</b> Restaurants, car dealers, food retail, gas stations, bars, pharmacies, specialty retail, membership warehouses (Costco), outlet malls</li>
          <li><b>Cultural/Recreation:</b> Parks, marinas, trails, camps, resorts, fairgrounds, libraries, swimming areas, entertainment venues, playgrounds</li>
          <li><b>Commercial/Industrial:</b> Sawmills, logging, food processing, petroleum, heavy manufacturing, metals, cannabis processing, engineering labs</li>
        </ul>

        <strong>What Remains</strong>
        <ul>
          <li><b>Zoning:</b> Commercial, Industrial, Trade, Services, Cultural/Recreation, Residential (SFR only), Undeveloped</li>
          <li><b>Lot size:</b> Default 2+ acres; use the slider to find smaller urban commercial sites</li>
          <li><b>Impervious surface:</b> 2+ acres for 20% zones; 1+ acre for 35-50% zones</li>
        </ul>

        <strong>Existing Gyms</strong>
        <p>558 gyms and fitness centers are shown as red dots, sourced from Overture Maps. These help identify areas with gym demand and validate the filtering criteria.</p>

        <p>Modeled after CrossFit Lake Stevens (2.92 ac, use code 111 SFR-Detached, garage-style gym operating with a conditional use permit on residential land).</p>
      </div>
    </div>

    <div class="filter-section">
      <h3>Search</h3>
      <form id="search-form" autocomplete="off">
        <div class="search-group">
          <input type="text" id="search-input" placeholder="Address or gym name">
          <button type="submit" id="search-btn">Go</button>
        </div>
        <p id="search-status"></p>
      </form>
    </div>

    <div class="filter-section">
      <h3>Zoning Category</h3>
      <div id="zone-filters"></div>
    </div>

    <div class="filter-section">
      <h3>Acreage</h3>
      <div class="range-label"><span id="acres-min-val">2</span> — <span id="acres-max-val">100+</span> ac</div>
      <div class="dual-range">
        <input type="range" id="acres-min" min="0" max="100" step="0.1" value="2">
        <input type="range" id="acres-max" min="0" max="100" step="0.1" value="100">
      </div>
    </div>

    <div class="filter-section">
      <h3>Market Value</h3>
      <div class="range-label">$<span id="value-min-val">0</span> — $<span id="value-max-val">2M+</span></div>
      <div class="dual-range">
        <input type="range" id="value-min" min="0" max="2000000" step="10000" value="0">
        <input type="range" id="value-max" min="0" max="2000000" step="10000" value="2000000">
      </div>
    </div>

    <div class="filter-section">
      <h3>City</h3>
      <select id="city-filter">
        <option value="">All Cities</option>
      </select>
    </div>

    <div class="filter-section">
      <label class="zone-checkbox">
        <input type="checkbox" id="show-gyms" checked>
        <span class="zone-swatch" style="background:#ff4136"></span>
        Show Existing Gyms (558)
      </label>
    </div>

    <div class="filter-section">
      <h3>Competition Analysis</h3>
      <label class="zone-checkbox">
        <input type="checkbox" id="show-buffer-3mi">
        <span class="zone-swatch" style="background:rgba(255,65,54,0.5)"></span>
        3-mile gym radius
      </label>
      <label class="zone-checkbox">
        <input type="checkbox" id="show-buffer-5mi">
        <span class="zone-swatch" style="background:rgba(255,152,0,0.5)"></span>
        5-mile gym radius
      </label>
    </div>

    <div class="filter-section">
      <h3>Demographics</h3>
      <label class="zone-checkbox">
        <input type="checkbox" id="show-income">
        <span class="zone-swatch" style="background:linear-gradient(90deg, #c0392b, #d4a017, #2d8a4e)"></span>
        Median Household Income
      </label>
    </div>

    <button id="reset-btn">Reset Filters</button>
  </div>

  <div id="map"></div>

  <div id="loading-overlay">
    <div class="spinner"></div>
    <p>Loading gym-friendly parcels...</p>
  </div>

  <div id="income-legend" style="display:none">
    <strong>Median Household Income</strong>
    <div class="legend-row"><span class="legend-swatch" style="background:#2d8a4e"></span> High ($75K+)</div>
    <div class="legend-row"><span class="legend-swatch" style="background:#d4a017"></span> Medium ($50-75K)</div>
    <div class="legend-row"><span class="legend-swatch" style="background:#c0392b"></span> Low (&lt;$50K)</div>
    <div class="legend-row"><span class="legend-swatch" style="background:#999"></span> No Data</div>
    <div class="legend-source">ACS 2022 5-Year Estimates</div>
  </div>

  <button id="basemap-toggle" title="Toggle satellite view">Satellite</button>

  <script src="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.js"></script>
  <script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>
  <script src="app.js?v=2"></script>
</body>
</html>
